# Default flags to build optimized version

Kmernator=/path/to/sourcecode/of/Kmernator
CMAKE=cmake

# for normal build
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O3 -g -Wall"

# for build with non-standard g++
ver=4.4.5
libdir=$(dirname $(g++-${ver} --print-file-name=libstdc++.so))
CXX=g++-${ver} \
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O3 -g -Wall  -Wl,-rpath,${libdir}"

# for NERSC hopper.nersc.gov: gcc compilers and MPICH2 xt-mpt, threaded MPI
module load cmake
module swap PrgEnv-pgi PrgEnv-gnu 
export OMP_NUM_THREADS=4
export MPICH_MAX_THREAD_SAFETY=multiple
module swap  xt-libsci/10.4.3 xt-libsci/10.4.0
CC=cc CXX=CC \
cmake $Kmernator \
    -DMPI_INCLUDE_PATH=${MPICH_DIR}/include    \
    -DMPI_LIBRARY="libc.a" -DMPI_LINK_FLAGS="-lmpich_threadm"  \
    -DCMAKE_CXX_FLAGS="-dynamic -O3 -Wall -g"

# for NERSC hopp2.nersc.gov:
module load cmake
module swap PrgEnv-pgi PrgEnv-gnu
module swap xt-mpt xt-mpich2
CC=cc CXX=CC cmake $Kmernator \
    -DMPI_INCLUDE_PATH=${MPICH_DIR}/include  \
    -DMPI_LIBRARY="libc.a"  -DMPI_LINK_FLAGS="-lmpich" \
    -DCMAKE_CXX_FLAGS="-dynamic -O3 -Wall -g"

# for NERSC carver
module unload pgi
module unload openmpi
module load gcc
module load openmpi-gnu
cmake $Kmernator -DCMAKE_CXX_FLAGS="-O3 -Wall -g"

# for static build -- BROKEN if MPI support is requested!
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O3 -g -Wall -static"

# for debug
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O0 -g -Wall -DDEBUG"

# for profile
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O3 -g -pg -Wall"

# no openmp
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O3 -g -Wall  -DDISABLE_OPENMP=1"

# no mpi
$CMAKE $Kmernator -DCMAKE_CXX_FLAGS="-O3 -g -Wall  -DDISABLE_MPI=1"

